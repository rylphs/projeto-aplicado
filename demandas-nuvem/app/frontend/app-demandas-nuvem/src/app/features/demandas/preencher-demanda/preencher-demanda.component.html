<div id="titulo">Formulário de Demandas Multicloud</div>

@if(!demanda){
<div id="sem-demanda">Demanda não encontrada</div>
}
@else {
<mat-stepper #stepper>

  <mat-step>
    <form class="step-form">
      <ng-template matStepLabel>Dados Gerais:</ng-template>
      <mat-form-field>
        <mat-label>Cliente</mat-label>
        <input disabled="" name="cliente" matInput [(ngModel)]="demanda.cliente">
      </mat-form-field>
      <mat-form-field>
        <mat-label>Email</mat-label>
        <input name="email" matInput [(ngModel)]="demanda.emailCliente">
      </mat-form-field>
      <mat-form-field>
        <mat-label>Descricao</mat-label>
        <input name="descricao" matInput [(ngModel)]="demanda.descricao">
      </mat-form-field>
      <div class="fill"></div>
      <div>
        <button mat-button matStepperNext>Próximo</button>
      </div>
    </form>
  </mat-step>

  <mat-step label="Adicionar Serviços">
    <form class="step-form">
      <h3>Serviços Adicionados</h3>

      <table mat-table [dataSource]="dataSourceServicos" class="mat-elevation-z8">

        <!-- Position Column -->
        <ng-container matColumnDef="label">
          <th mat-header-cell *matHeaderCellDef> Nome </th>
          <td mat-cell *matCellDef="let element"> {{element.label}} </td>
        </ng-container>

        <!-- Name Column -->
        <ng-container matColumnDef="quantidade">
          <th mat-header-cell *matHeaderCellDef> Quantidade </th>
          <td mat-cell *matCellDef="let element"> {{element.quantidade}} </td>
        </ng-container>

        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef> Ações </th>
          <td mat-cell *matCellDef="let element" class="actions-col" >
            <button mat-mini-fab aria-label="Editar" >
              <mat-icon>edit</mat-icon>
            </button>
            <button mat-mini-fab aria-label="Excluir" >
              <mat-icon>delete</mat-icon>
            </button>
          </td>
        </ng-container>


        <tr mat-header-row *matHeaderRowDef="colunasServicos"></tr>
        <tr mat-row *matRowDef="let row; columns: colunasServicos;"></tr>

        <!-- Row shown when there is no matching data. -->
        <tr class="mat-row" *matNoDataRow>
          <td class="mat-cell" colspan="4">Sem serviços adicionados</td>
        </tr>
      </table>

      <div id="adicionar-servico">
      <h3>Adicionar Serviço</h3>
      <div id="card-servicos">
      @for(servico of servicos; track servico){
        <mat-card class="servico-card" appearance="outlined">
          <mat-card-header>
            <mat-card-title>{{servico.label}}</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <p>{{servico.descricao}}</p>
          </mat-card-content>
          <mat-card-footer>
            <button (click)="adicionarServico(servico)" mat-button>Adicionar</button>
          </mat-card-footer>
        </mat-card>
      }
      </div>
      </div>
      <div class="fill"></div>
      <div>
        <button mat-button matStepperPrevious>Anterior</button>
        <button mat-button matStepperNext>Próximo</button>
      </div>
    </form>
  </mat-step>

  <mat-step label="Anexar Arquivos">
    <form class="step-form">
    <table mat-table [dataSource]="dataSource" class="mat-elevation-z8">

      <ng-container matColumnDef="nome">
        <th mat-header-cell *matHeaderCellDef> Nome </th>
        <td mat-cell *matCellDef="let element"> {{element.nome}} </td>
      </ng-container>

      <!-- Name Column -->
      <ng-container matColumnDef="tipo">
        <th mat-header-cell *matHeaderCellDef> Tipo </th>
        <td mat-cell *matCellDef="let element"> {{element.tipo}} </td>
      </ng-container>

      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef> Ações </th>
        <td mat-cell *matCellDef="let element" class="actions-col" >
          <button mat-mini-fab aria-label="Remover" (click)="removerAnexo(element)">
            <mat-icon>delete</mat-icon>
          </button>
        </td>
      </ng-container>


      <tr mat-header-row *matHeaderRowDef="columns"></tr>
      <tr mat-row *matRowDef="let row; columns: columns;"></tr>

      <!-- Row shown when there is no matching data. -->
      <tr class="mat-row" *matNoDataRow>
        <td class="mat-cell" colspan="4">Sem anexos</td>
      </tr>
    </table>
    <input #csvInput hidden="true" type="file" (change)="adicionarAnexo($event)" onclick="this.value=null"/>
    <div  id="add-button">
        <button mat-flat-button color="primary" (click)="csvInput.click()">Adicionar Arquivo</button>
    </div>

      <div class="fill"></div>
      <div>
        <button mat-button matStepperPrevious>Anterior</button>
        <button mat-button matStepperNext>Próximo</button>
      </div>
    </form>
  </mat-step>

  <mat-step>
    <form class="step-form">
    <ng-template matStepLabel>Revisar e Solicitar</ng-template>
    <p>Cliente: {{demanda.cliente}}</p>
    <p>Descrição: {{demanda.descricao}}</p>
    <div>Serviços</div>

    <p>Pendências</p>
    <div class="fill"></div>
    <div>
      <button mat-button matStepperPrevious>Anterior</button>
      <button mat-button (click)="stepper.reset()">Solicitar</button>
    </div>
  </form>
  </mat-step>
</mat-stepper>
}